#!/bin/bash
# Conventional Commits validation for auto-release (svu) compatibility

commit_msg_file="$1"
commit_msg=$(cat "$commit_msg_file")

# Skip merge commits
if echo "$commit_msg" | grep -q "^Merge "; then
    exit 0
fi

# Conventional Commits format: type(scope)?: description
# Types: feat, fix, docs, style, refactor, perf, test, chore, ci, build, revert
if ! echo "$commit_msg" | grep -qE '^(feat|fix|docs|style|refactor|perf|test|chore|ci|build|revert)(\(.+\))?!?:'; then
    echo ""
    echo "‚ùå Commit message does not follow Conventional Commits format."
    echo ""
    echo "Required format:"
    echo "  <type>(<scope>): <description>"
    echo ""
    echo "Valid types:"
    echo "  feat     - New feature"
    echo "  fix      - Bug fix"
    echo "  docs     - Documentation"
    echo "  style    - Code style"
    echo "  refactor - Code refactoring"
    echo "  perf     - Performance"
    echo "  test     - Tests"
    echo "  chore    - Maintenance"
    echo "  ci       - CI/CD"
    echo "  build    - Build system"
    echo "  revert   - Revert commit"
    echo ""
    echo "Examples:"
    echo "  feat: add user authentication"
    echo "  fix(api): handle null response"
    echo "  docs(readme): update installation steps"
    echo ""
    echo "This format is required for auto-release (svu) to work correctly."
    echo ""
    exit 1
fi
